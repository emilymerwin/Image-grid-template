<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Image grid with info cards</title>
	<link rel="stylesheet" href="http://host.coxmediagroup.com/ajc/digitalprojects/global/css/iFrame_Medley.css" type="text/css" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		.bigImg {
			 width: 260px;
			 height: 260px;
			 -moz-box-shadow: 0 0 5px #888;
			 -webkit-box-shadow: 0 0 5px#888;
			 box-shadow: 0 0 5px #888;
		}
		.lilImg {
			width: 120px;
			height: 120px;
		}
		img {
			border: none;
			padding: 0;
			margin: 0;
			vertical-align: middle;
		}
		a strong {
			color: #000098;
		}
		.dates {
			margin-left: 5px;
		}
		#boxContainer {
			-moz-box-shadow: 0 0 5px #888;
			-webkit-box-shadow: 0 0 5px#888;
			box-shadow: 0 0 5px #888;
			border: 2px solid #ccc;
			-moz-border-radius: 5px;
			border-radius: 5px;
			z-index: 100;
			display: none;
			width: 500px;
			height: 350px;
			background-color: #fff;
			overflow: hidden;
			position: absolute;
			top: 10px;
			left: 50px;
			padding-top: 20px;
		}
		.slideDiv {
			width: 550px;
			height: 420px;
			display: inline;
			border: none;
			position: absolute;
			padding: 0;
			margin: 0;
		}
		.names {
			font-size: 24px;
			padding-left: 30px;
			margin-top: 15px;
		}
		.images {
			float: left;
			display: inline;
			padding: 5px;
			padding-left: 30px;
		}
		.information {
			float: left;
			display: inline;
			height: 300px;
			width: 200px;
			padding-top: 10px;
		}
		#leftHov, #rightHov {
			position: absolute;
			top: 0px;
			z-index: 100;
			display: none;
		}
		#leftHov {
			left: 0px;
		}
		#rightHov {
			right: 0px;
		}
		#hiddenLayer {
			z-index: 1;
			position: absolute;
			top: 0px;
			left: 0px;
			width: 100%;
			height: 100%;
			display: none;
		}
		#portraitList {
			height: 350px;
			position: absolute;
			top: 0;
			left: 0;
			margin: 0;
			padding: 0;
		}
		#closeBtn {
			z-index: 500;
			position: absolute;
			right: 0px;
			top: 320px;
			width: 30px;
			height: 40px;
		}
		#closeBtn a {
			text-decoration: none;
			color: #000;
			font-family:'Arial',sanserif;
		}
	</style>
	<script src="http://code.jquery.com/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="http://alt.coxnewsweb.com/ajc/_newsapps/libraries/utility/tabletop/tabletop.js" type="text/javascript"></script>
	<script type="text/javascript">
	var public_spreadsheet_url, url = window.location.toString(), query_string = url.split("?"), cardWidth = 500, winHeight = $(window).height();
	var $portraits = $('#portraitList'), $boxContainer = $('#boxContainer'), $leftHov = $("#leftHov"), $rightHov = $("#rightHov"), $hiddenLayer = $("#hiddenLayer");
	window.onload = function() {
		public_spreadsheet_url = query_string[2];
		init();
	};

	function init() {
	    Tabletop.init({key: public_spreadsheet_url, callback: parsePeeps, simpleSheet: true});
	}

	function parsePeeps(gdata) {
		$.each(gdata, function (i, gdata) {
			gridID = "img"+i;
			name = gdata.bigtext;
			narrative = gdata.content;
			if(gdata.smalltext !== undefined) {
				smalltext = gdata.smalltext;
			} else {
				smalltext = "";
			}
			slideID = gridID + "div";
			imgSrc = gdata.imageurl;
			lilImg = '<img class="lilImg" id='+gridID+' src="' + imgSrc + '"/>';
			bigImg = '<img class="bigImg" src="' + imgSrc + '"/>';
			var slot= i*cardWidth; //place slide within popup slider

			$("#grid").append('<div class="col-sm-4">'+lilImg+'</div>');

			//make image grid click to open lightbox
			$('#'+gridID).click(function(event) {
				$boxContainer.show();

				var boxHeight = $boxContainer.height(), docHeight = $(document).height(), pageY = event.pageY;
				//relocate popup box based on how far down the page you are
				if(pageY <= (boxHeight + 10) && pageY <= (winHeight - boxHeight)) {
					$boxContainer.css({'top': pageY + 5});
				} else if(pageY >= (winHeight - boxHeight) && pageY <= winHeight) {
					$boxContainer.css({'top': (winHeight - boxHeight - 50)});
				} else if(pageY >= winHeight && event.clientY > winHeight - boxHeight) {
					$boxContainer.css({'top': (pageY - boxHeight - 50)});
				} else {
					$boxContainer.css({'top': pageY});
				}
				$portraits.css({'left':'0'});
				$portraits.animate({'left':'-='+slot},'100');
				$hiddenLayer.show();
			});
			//close lightbox
			$('#closeBtn').click(function(event) {
				$portraits.css({'left':'0'});
				$boxContainer.hide();
				$hiddenLayer.hide();
			});
			$hiddenLayer.click(function(event) {
				$portraits.css({'left':'0'});
				$boxContainer.hide();
				$hiddenLayer.hide();
			});

			//fill lightbox with info
			var divStuff = '<div id="name'+gridID+'"><span class="names"><strong>'+name+'</strong></span><span class="dates">'+smalltext+'</span></div><div style="width:'+cardWidth+'px;height:280px;display:block;"><div class="images" id="img'+gridID+'">'+bigImg+'</div><div class="information" id="info'+gridID+'"><p>'+narrative+'</p></div></div>';
			$portraits.append('<div id="'+slideID+'" class="slideDiv">'+divStuff+'</div>');
			$('#'+slideID).css({'left': slot});
		});//$.each()

		slideWidth = $(".slideDiv").length * cardWidth;

		$boxContainer.mouseover(function() {
			$leftHov.show();
			$rightHov.show();
		});
		$boxContainer.mouseout(function() {
			$rightHov.hide();
			$leftHov.hide();
		});

		//positioning within lightbox

		$leftHov.bind("click", function() {
			if($portraits.position().left < 0) {
				$portraits.animate(
					{"left":"+="+cardWidth},
					{speed: "fast"}
				);
			}
		});
		$rightHov.bind("click", function() {
			if($portraits.position().left > -1*(slideWidth-cardWidth)) {
				$portraits.animate(
					{"left":"-="+cardWidth},
					{speed: "fast"}
				);
			}
		});
	};//parsePeeps
	</script>
</head>
<body style="margin:0px; font-family:'Georgia','Serif';">
	<div class="container">
		<div class="row" id="grid"></div>
		<div id="hiddenLayer"></div>
		<!--overlay div-->
		<div id="container1">
			<div id="boxContainer">
				<div id="leftHov"><img src="assets/left.png" alt="slide left"/></div>
				<div id="rightHov"><img src="assets/right.png" alt="slide right"/></div>
				<div id="portraitList"></div>
				<div id="closeBtn">X</div>
			</div>
		</div>
	</div>
</body>
</html>