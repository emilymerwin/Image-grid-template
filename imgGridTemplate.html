<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Image grid with info cards</title>
	<link rel="stylesheet" href="http://host.coxmediagroup.com/ajc/digitalprojects/global/css/iFrame_Medley.css" type="text/css" />
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">
	<script src="http://code.jquery.com/jquery-1.9.1.min.js" type="text/javascript"></script>
	<script src="http://alt.coxnewsweb.com/ajc/_newsapps/libraries/utility/tabletop/tabletop.js" type="text/javascript"></script>
</head>
<body style="margin:0px; font-family:'Georgia','Serif';">
	<div class="container-fluid">
		<div class="row" id="grid"></div>
		<div id="hiddenLayer"></div>
	</div>
	<!--overlay div-->
	<div class="container">
		<div class="row">
			<div id="boxContainer">
				<div id="sliderBody" class="center-block">
					<div id="leftHov"><img src="assets/left.png" alt="slide left"/></div>
					<div id="rightHov"><img src="assets/right.png" alt="slide right"/></div>
					<div id="portraitList"></div>
					<div id="closeBtn">X</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
	var public_spreadsheet_url, url = window.location.toString(), query_string = url.split("?"), cardWidth = 500, winHeight = $(window).height(), winWidth = $(window).width(), isMobile = false;
	var $portraits = $('#portraitList'), $boxContainer = $('#boxContainer'), $leftHov = $("#leftHov"), $rightHov = $("#rightHov"), $hiddenLayer = $("#hiddenLayer");

	if(winWidth <500){
		isMobile = true;
		cardWidth = winWidth*.9;
	}
	window.onload = function() {
		public_spreadsheet_url = query_string[2];
		init();
	};

	function init() {
	    Tabletop.init({key: public_spreadsheet_url, callback: parsePeeps, simpleSheet: true});
	}

	function parsePeeps(gdata) {
		$.each(gdata, function (i, gdata) {
			var gridID = "img"+i,
			itemName = gdata.bigtext,
			narrative = gdata.content,
			smalltext = "",
			slideID = gridID + "div",
			imgSrc = gdata.imageurl,
			lilImg = '<img class="lilImg" id='+gridID+' src="' + imgSrc + '"/>',
			bigImg = '<img class="bigImg" src="' + imgSrc + '"/>',
			slot= i*cardWidth; //place slide within popup slider

			if(gdata.smalltext !== undefined) {
				smalltext = gdata.smalltext;
			}

			$("#grid").append('<div class="col-xs-4 col-sm-3 col-md-2">'+lilImg+'</div>');

			//make image grid click to open lightbox
			$('#'+gridID).click(function(event) {
				$boxContainer.show();

				var boxHeight = $boxContainer.height(), docHeight = $(document).height(), pageY = event.pageY;
				//relocate popup box based on how far down the page you are
				if(pageY <= (boxHeight + 10) && pageY <= (winHeight - boxHeight)) {
					$boxContainer.css({'top': pageY + 5});
				} else if(pageY >= (winHeight - boxHeight) && pageY <= winHeight) {
					$boxContainer.css({'top': (winHeight - boxHeight - 50)});
				} else if(pageY >= winHeight && event.clientY > winHeight - boxHeight) {
					$boxContainer.css({'top': (pageY - boxHeight - 50)});
				} else {
					$boxContainer.css({'top': pageY});
				}
				$portraits.css({'left':'0'});
				$portraits.animate({'left':'-='+slot},'100');
				$hiddenLayer.show();
			});
			//close lightbox
			$('#closeBtn').click(function(event) {
				$portraits.css({'left':'0'});
				$boxContainer.hide();
				$hiddenLayer.hide();
			});
			$hiddenLayer.click(function(event) {
				$portraits.css({'left':'0'});
				$boxContainer.hide();
				$hiddenLayer.hide();
			});

			//fill lightbox with info
			var divStuff = '<div id="name'+gridID+'"><span class="names"><strong>'+name+'</strong></span><span class="dates">'+smalltext+'</span></div><div style="width:'+cardWidth+'px;height:280px;display:block;"><div class="images" id="img'+gridID+'">'+bigImg+'</div><div class="information" id="info'+gridID+'"><p>'+narrative+'</p></div></div>';
			$portraits.append('<div id="'+slideID+'" class="slideDiv row">'+divStuff+'</div>');
			$('#'+slideID).css({'left': slot});
		});//$.each()

		slideWidth = $(".slideDiv").length * cardWidth;

		$boxContainer.mouseover(function() {
			$leftHov.show();
			$rightHov.show();
		});
		$boxContainer.mouseout(function() {
			$rightHov.hide();
			$leftHov.hide();
		});

		//positioning within lightbox

		$leftHov.bind("click", function() {
			if($portraits.position().left < 0) {
				$portraits.animate(
					{"left":"+="+cardWidth},
					{speed: "fast"}
				);
			}
		});
		$rightHov.bind("click", function() {
			if($portraits.position().left > -1*(slideWidth-cardWidth)) {
				$portraits.animate(
					{"left":"-="+cardWidth},
					{speed: "fast"}
				);
			}
		});
	};//parsePeeps
	</script>
</body>
</html>